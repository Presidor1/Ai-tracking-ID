{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <div class="card shadow p-4 mx-auto" style="max-width: 550px;">
    <h1 class="h3 mb-3 text-center text-primary">📷 ID Tracking AI</h1>
    <p class="text-muted text-center">
      Upload an ID image to analyze its type, dimensions, and extract useful details.
    </p>

    <!-- Upload Form -->
    <form id="uploadForm" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="file" class="form-label fw-bold">Choose Image</label>
        <input class="form-control" type="file" id="file" name="file" accept="image/*" required>
      </div>

      <!-- Preview -->
      <div id="previewContainer" class="text-center mb-3" style="display: none;">
        <h6 class="text-secondary">Preview:</h6>
        <img id="previewImage" class="img-fluid rounded shadow-sm" style="max-height: 200px;" alt="Preview">
      </div>

      <button class="btn btn-primary w-100" type="submit">🚀 Upload & Analyze</button>
    </form>

    <!-- Response -->
    <pre class="response mt-4 text-success small bg-light p-3 rounded" id="response"></pre>
  </div>
</div>

<script>
  const form = document.getElementById('uploadForm');
  const fileInput = document.getElementById('file');
  const responseDiv = document.getElementById('response');
  const previewContainer = document.getElementById('previewContainer');
  const previewImage = document.getElementById('previewImage');

  // Show preview when file selected
  fileInput.addEventListener('change', () => {
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImage.src = e.target.result;
        previewContainer.style.display = 'block';
      };
      reader.readAsDataURL(file);
    } else {
      previewContainer.style.display = 'none';
    }
  });

  // Handle upload
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    responseDiv.textContent = '⏳ Uploading...';

    const formData = new FormData(form);

    try {
      const res = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      const data = await res.json();
      responseDiv.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
      responseDiv.textContent = '❌ Error: ' + err.message;
    }
  });
</script>
{% endblock %}
